<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

  <h:head>
    <meta charset="UTF-8" />
    <meta name="google" content="notranslate" />
    <meta http-equiv="Content-Language" content="en_US" />
    <title>Agnos admin</title>
  </h:head>

  <h:body style="background: black; opacity: 0">
                 
    <ui:include src="header.xhtml" />      



    <p:dialog header="Agnos admin" widgetVar="loginDialog" resizable="false" draggable="false" visible="#{!login.loggedIn}" closable="false">
      <h:form id="loginForm" style="width: auto">

        <p:panelGrid style="width:auto; padding:1em">

          <p:row>
            <p:column styleClass="borderT borderL">   
              <label>Username:</label>
            </p:column>

            <p:column styleClass="borderT borderR"> 
              <p:inputText id="username" value="#{login.username}" required="true" />
            </p:column>              
          </p:row> 

          <p:row>
            <p:column styleClass="borderL">    
              <label>Password:</label>
            </p:column>
            <p:column styleClass="borderR"> 
              <p:password id="password" value="#{login.password}" required="true" />
            </p:column>                                                         
          </p:row> 

          <p:row>
            <p:column colspan="2" styleClass="borderB borderL borderR">                  
            </p:column>            
          </p:row> 

        </p:panelGrid>

        <div class="bottomButtonsDiv">
          <p:commandButton value="Login" actionListener="#{login.login}"
                           styleClass="saveButton"
                           oncomplete="handleLoginRequest(xhr, status, args)"
                           update=":loginForm :header :content"/>
        </div>

      </h:form>
    </p:dialog>


    <h:form id="content" styleClass="mainForm">

      <p:panelGrid styleClass="mainTable" rendered="#{login.loggedIn}">

        <p:row>
          <p:column colspan="2" >
            <h1>
              Agnos @ Vascular                   
              <h:outputText id="greeter2" styleClass="centeredContent" value="Hello #{login.realName}" />
              <p:commandButton
                  ajax="true"
                  rendered="true"                  
                  process=":content"
                  value="Kilépés"
                  update=":loginForm :content"
                  action="#{login.logout()}"
                  styleClass="deleteReportButton">
              </p:commandButton>
              
            </h1>                

          </p:column>
        </p:row>

        <p:row>
          <p:column styleClass="mainPanel">
            <div class="mainPanelBackground" onclick="setCookie('token', '#{login.token}', 30000); setCookie('user', '#{login.username}', 30000); window.location = 'http://localhost:8383/Agnos/';">
              <div class="mainPanelTitle">
                <span class="ui-dialog-title">Agnos jeletések oldala</span>
              </div>
              <div class="mainPanelContent">
              </div>            
            </div>
          </p:column>

          <p:column styleClass="mainPanel">  
            <div class="mainPanelBackground">
              <div class="mainPanelTitle">
                <span class="ui-dialog-title">Agnos admin</span>
              </div>
              <div class="mainPanelContent">
                <p:link value="Manage reports" rendered="#{login.isPermitted('REPORTADMIN')}" href="/reportChoser.xhtml" />
                <br />
                <p:link value="Manage users" rendered="#{login.isPermitted('USERADMIN')}" href="/userChoser.xhtml" />
              </div>            
            </div>            
          </p:column>
        </p:row> 

        <p:row>
          <p:column styleClass="mainPanel">    
            <div class="mainPanelBackground">
              <div class="mainPanelTitle">
                <span class="ui-dialog-title">Agnos admin</span>
              </div>
              <div class="mainPanelContent">                
              </div>            
            </div>            
          </p:column>

          <p:column styleClass="mainPanel">    
            <div class="mainPanelBackground">
              <div class="mainPanelTitle">
                <span class="ui-dialog-title">Agnos adminisztrációs oldal</span>
              </div>
              <div class="mainPanelContent">
                <p:link value="Jelentések szerkesztése" rendered="#{login.isPermitted('REPORTADMIN')}" href="/reportChoser.xhtml" />
                <br />
                <p:link value="Felhasználók kezelése" rendered="#{login.isPermitted('USERADMIN')}" href="/userChoser.xhtml" />
              </div>            
            </div>            
          </p:column>

        </p:row> 

      </p:panelGrid>

    </h:form>



    <script type="text/javascript">
        function handleLoginRequest(xhr, status, args) {
            if (args.validationFailed || !args.loggedIn) {
                PF('loginDialog').jq.effect("shake", {times: 5}, 100);
            } else {
                console.log(xhr, status, args);
                PF('loginDialog').hide();
            }
        }
    </script>
  </h:body>

</html>